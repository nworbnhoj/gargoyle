var bkS=new Object;var toggleReload=false;var globalLanIp;function getBackup(){setControlsEnabled(false,true,bkS.PrepBack);var param=getParameterDefinition("commands","sh /usr/lib/gargoyle/create_backup.sh ;\n")+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,""));var stateChangeFunction=function(req){if(req.readyState==4){setControlsEnabled(true);window.location="/dump_backup_tarball.sh"}};runAjax("POST","utility/run_commands.sh",param,stateChangeFunction)}function doRestore(){if(document.getElementById("restore_file").value.length==0){alert(bkS.SelCErr)}else{confirmRestore=window.confirm(bkS.EraseWarn);if(confirmRestore){document.getElementById("restore_hash").value=document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"");document.getElementById("restore_form").submit();setControlsEnabled(false,true,bkS.UpingC)}}}function doDefaultRestore(){var confirmRestore=window.confirm(bkS.EraseWarn);if(confirmRestore){document.getElementById("restore_original_hash").value=document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"");document.getElementById("restore_original_form").submit();setControlsEnabled(false,true,bkS.LdOrig)}}function restoreFailed(){setControlsEnabled(true);alert(bkS.FailErr)}function restoreSuccessful(lanIp){setControlsEnabled(false,true,UI.waitText);globalLanIp=lanIp;var param=getParameterDefinition("commands","sh /usr/lib/gargoyle/reboot.sh ;\n")+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,""));var stateChangeFunction=function(req){return 0};runAjax("POST","utility/run_commands.sh",param,stateChangeFunction);currentProtocol=location.href.match(/^https:/)?"https":"http";testLocation=currentProtocol+"://"+globalLanIp+":"+window.location.port+"/utility/reboot_test.sh";testReboot=function(){toggleReload=true;setTimeout("testReboot()",5*1e3);document.getElementById("reboot_test").src=testLocation};setTimeout("testReboot()",25*1e3);setTimeout("reloadPage()",240*1e3)}function reboot(lanIp){setControlsEnabled(false,true,UI.waitText);globalLanIp=lanIp;currentProtocol=location.href.match(/^https:/)?"https":"http";testLocation=currentProtocol+"://"+globalLanIp+":"+window.location.port+"/utility/reboot_test.sh";testReboot=function(){toggleReload=true;setTimeout("testReboot()",5*1e3);document.getElementById("reboot_test").src=testLocation};setTimeout("testReboot()",25*1e3);setTimeout("reloadPage()",240*1e3)}function reloadPage(){if(toggleReload){var reloadState=document.getElementById("reboot_test").readyState;if(typeof reloadState=="undefined"||reloadState==null||reloadState=="complete"){toggleReload=false;document.getElementById("reboot_test").src="";currentProtocol=location.href.match(/^https:/)?"https":"http";window.location=currentProtocol+"://"+globalLanIp+":"+window.location.port+window.location.pathname}}}